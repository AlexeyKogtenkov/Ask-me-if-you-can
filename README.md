# Проект "Ask me"
Алексей Когтенков, 151 группа БПМИ ФКН ВШЭ

* НА ДАННЫЙ МОМЕНТ README НАХОДИТСЯ В СОСТОЯНИИ РАЗРАБОТКИ И НЕ ОТРАЖАЕТ РЕАЛЬНОЕ ПОЛОЖЕНИЕ ДЕЛ 

**О проекте**

Довольно известным фактом является то, что многие компании (в частности, Google, Yandex и другие) занимаются проблемой распознавания речи, картинок и т.д. Одним из таких разделов в области распознавания является распознавание фраз, выделение из них сути и генерация ответа, если таковой известен системе. Примерами таких алгоритмов являются разнообразные чатботы. Также решение этой задачи позволяет быстро находить необходимую информацию в тексте (например, в википедии) машинным образом.

Не так давно появилась статья, в которой описывается способ реализации подобных программ при использовании одних только нейронных сетей. Это довольно новый подход, поскольку абсолютное большинство алгоритмов сейчас не используют в большом объеме нейронные сети, а содержат в себе решающие деревья, явные алгоритмы классификации и так далее. Реализация алгоритма, описанного в статье, - это и есть основная задача проекта. Попутно были решены также некоторые дополнительные задачи.

**Выполненная работа и разделы репозитория**

При работе над проектом использованы и изучены полносвязные, конволюционные и рекуррентные сети.

Язык программирования: Python3, поскольку он довольно простой и имеет большое количество различных библиотек. Это обеспечивает хорошую читаемость кода и быструю разработку.

Использованы библиотеки: 

a) numpy - для операций над матрицами, 

b) scipy - для различных сложных математических операций,

c) matplotlib - для отрисовки графиков, 

d) theano, tensorflow, keras - пакеты для реализации нейронных сетей.

e) sklearn - библиотека с различными полезными функциями и алгоритмами (SVD-разложение, t-SNE и прочие).

Основной проект и все необходимые файлы находятся непосредственно в ветке master. Также в master находится папка labs с файлами выполненных лабораторных работ. Последние необходимы были исключительно для обучения, поэтому никакой документации и описания к ним не прилагается. Далее речь пойдет только об основном проекте.

**Краткое описание программы и важные сведения**

Программа предоставляет пользователю простой интерфейс доступа к операциям создания, обучения и тестирования нейронной сети, которая для текста и вопроса по нему генерирует ответ на вопрос в виде _одного_ слова. Также доступны команды для подготовки данных для обучения/тестирования нейронной сети.

Приложение тестировалось на bAbI-task задании, и в текущей конфигурации оно заточено именно под него. А именно, при работе нейронной сети при кодировании слов используется one-hot кодирование, то есть скорость работы и количество потребляемой памяти линейно зависит от количества различных слов в текстах. В bAbI-task задании используется всего около 200 разных слов, однако не предполагается использование данного приложения в текущем виде на данных с большим количеством различных слов. Для использования на больших данных необходима модификация функций обработки текста и использование word2vec (реализация word2vec на данных из википедии была выполнена в одной из лабораторных).

**Системные требования**

ОС: Linux, Windows*

Процессор: любой*

Оперативная память: минимум 4 Гб (bAbI-task)*

Место на жёстком диске: 100 Мб (для сохранения нейронных сетей)

Дополнительные необходимые утилиты: интерпретатор Python3, библиотеки numpy и tensorflow для Python3, желательно jupyter notebook.

\* Приложение разрабатывалось и проверялось на Ubuntu с 4-ядерным процессором 2.4 ГГц и 8 Гб оперативной памяти. Кроссплатформенность достигается за счет кроссплатформенности языка Python. Скорость процессора будет влиять на скорость работы программы, а количество оперативной памяти - на максимальный размер нейронной сети, которую можно создать и обучить.

**Реализованная модель нейронной сети**

Coming soon...

**Файлы для обучения и тестирования нейронной сети**

Для обучения и тестирования нейронной сети в моем приложении используются текстовые файлы определенного вида. Эти файлы делятся на 2 типа: основной файл и словарь. Для корректной работы нейронной сети в режиме обучения и тестирования необходимы оба этих файла. Основной файл всегда состоит из так называемых абзацев, каждый абзац имеет вид

    sentence1
    sentence2
    ...
    sentencen
    QUESTION
    question
    ANSWER
    answer
где sentence, question и answer - это строки вида

    word1 word2 ... wordm EOF
где word - это слово.
Пример такого абзаца:

    brian is black EOF
    emily is yellow EOF
    QUESTION
    what color is emily EOF
    ANSWER
    yellow
Абзацы должны разделяться пустыми строками.
Файл со словарем имеет вид

    ind1 word1
    ind2 word2
    ...
    indk wordk
где word - это слово, ind - его номер в словаре. Оба файла генерируются приложением с помощью пользовательских команд, поэтому пользователь может обойтись без прямого взаимодействия с их содержимым. Однако важно отметить, что все слова в обоих файлах не содержат заглавных букв.

**Поддерживаемые форматы данных**

Для более удобного пользования приложением была реализована функция преобразования текстовых данных для обучения/тестирования в используемый нейронной сетью формат (см. "Файлы для обучения и тестирования нейронной сети"). Эта функция поддерживает 2 формата записи данных:

1) bAbI-task формат. В этом формате данные состоят из так называемых абзацев. Каждый абзац состоит из строк вида

        N Word1 word2 ... wordn.
    
      или

        N Word1 word2 ... wordn?   answer n1 n2 n3 ... nk
    
    Здесь word - это слово; N - номер предложения в абзаце; n1, n2, ..., nk - номера предложений, из которых следует ответ; answer - это слово-ответ на строку-вопрос. Стоит отметить, что чисел n1, n2, ..., nk может и не быть.

    Пример куска текста в bAbI-task формате:

        12 Sandra got the milk there.
        13 Mary went to the bedroom.
        14 What is Sandra carrying? 	milk	12
        15 Sandra moved to the garden.
        16 Daniel journeyed to the hallway.
        17 What is Sandra carrying? 	milk	12
        1 Sandra went back to the bedroom.
        2 Daniel got the football there.

2) Обычный (интуитивный) формат. В этом формате данные состоят из абзацев. Каждый абзац имеет вид

        Word1 word2 word3 ... wordn.
    
      или
        
        Word1 word2 ... wordn? answer n1 n2 ... nk
    
      Здесь word - это слово; n1, n2, ..., nk - номера предложений, из которых следует ответ; answer - это слово-ответ на строку-вопрос. Стоит отметить, что чисел n1, n2, ..., nk может и не быть.

**Туториал**

Данный туториал поверхностно показывает принцип взаимодействия пользователя с приложением на примере некоторых команд.

В самом начале необходимо скачать код проекта askme.py из этого репозитория и файл test.txt. Перейдем в папку с кодом и файлом и запустим приложение с помощью консольной команды

    ./askme.py
Появится приветственная фраза приложения. Прежде всего, нам нужно подготовить данные. Наши данные для тестирования записаны в обычном формате (см. "Поддерживаемые форматы данных") в файле test.txt. Используем команду prepare data (см. список команд).

    prepare data test.txt
    
В результате выполнения этой строки приложением будет создан файл 'test_prepared.txt' с подготовленными данными. Далее нам необходимо по этим данным создать словарь. Выполним команду

    prepare dictionary test_prepared.txt

Итогом работы этой строки будет создание файла dict_test.txt, в котором будет содержаться словарь слов файла test_prepared.txt.

Теперь создадим нейронную сеть.

    create model

coming soon...

**Список команд**

Программа представляет из себя заготовку небольшой библиотеки на языке Python3 с пользовательской оболочкой. Для пользователя, который хочет использовать реализованную нейронную сеть в чистом виде, предоставляется консольный интерфейс взаимодействия с помощью команд:

1) help \<command>. Эта команда позволяет посмотреть краткий мануал по использованию команды \<command>. 

2) prepare. У этой команды есть множество различных вариаций. Использование этой команды позволяет приводить исходные текстовые файлы к виду, который используется для обучения и тестирования нейронной сети.

      a) prepare data \<filename>. Эта команда приводит файл \<filename> с текстом в обычном формате (см. "Поддерживаемые форматы") к виду, который использует нейронная сеть, и сохраняет в файл, название которого генерируется автоматически исходя из названия \<filename>. ВАЖНО: для корректной работы этой команды название \<filename> должно заканчиваться на ".txt".
      
      b) prepare data \<filename> \<output>. Эта команда приводит файл \<filename> с текстом в обычном формате к виду, который использует нейронная сеть, и сохраняет в файл \<output>.
      
      c) prepare babidata \<filename>. Эта команда приводит файл \<filename> с текстом в bAbI-формате (см. "Поддерживаемые форматы") к виду, который использует нейронная сеть, и сохраняет в файл, название которого генерируется автоматически исходя из названия \<filename>. ВАЖНО: для корректной работы этой команды название \<filename> должно заканчиваться на ".txt".
      
      d) prepare babidata \<filename> \<output>. Эта команда приводит файл \<filename> с текстом в bAbI-формате к виду, который использует нейронная сеть, и сохраняет в файл \<output>.
      
      e) prepare dictionary \<filename>. Эта команда создает словарь по файлу \<filename> с подготовленными данными (т.е. сгенерированными с помощью команды prepare data или prepare babidata) и сохраняет его в файл с названием, которое генерируется исходя из названия файла \<filename>.
      
      f) prepare dictionary \<filename> \<output>. Эта команда создает словарь по файлу \<filename> с подготовленными данными (т.е. сгенерированными с помощью команды prepare data или prepare babidata) и сохраняет его в файл \<output>.

3) create model. Эта команда позволяет создать модель. Является обязательной командой перед любыми операциями с нейронной сетью (загрузкой значений матриц с помощью load, сохранением, обучением, тестированием и т.д.). После ввода этой команды появится контекстное интерактивное меню, в котором надо выбрать:

    NUM_SENTENCES - максимальное количество предложений в тексте.
    
    INPUT_SIZE - размер словаря, который мы хотим использовать для нейронной сети. По умолчанию это значение равно размеру текущего загруженного словаря.
    
    HIDDEN_SIZE - характерный размер скрытых слоев нейронной сети.
    
    NUM_PASSES - количество проходов по данным внутри сети (см. "Реализованная модель нейронной сети").
    
4) load. Эта команда позволяет загружать модели и словари. 

      a) load model \<name>. Эта команда позволяет загрузить модель с названием \<name>. Важно отметить, что одновременно приложение может хранить в оперативной памяти информацию только об одной модели. Загрузка модели затрет всю информацию о предыдущей модели.
      
      b) load dictionary \<filename>. Эта команда позволяет загрузить словарь из файла \<filename>. Важно отметить, что одновременно приложение может хранить в оперативной памяти только один словарь. Загрузка словаря затрет предыдущий словарь.
      
5) train. Эта команда позволяет обучать модель. После ввода этой команды появится контекстное интерактивное меню, в котором надо выбрать:
    
    (coming soon...)
    
    Важно сказать, что во время обучения никакие команды не доступны. Это сделано для ускорения работы. 
    
6) test. Эта команда позволяет тестировать модель. После ввода этой команды появится контекстное интерактивное меню, в котором надо выбрать:

    (coming soon...)
    
    Важно сказать, что во время тестирования никакие команды не доступны. Это сделано для ускорения работы. 
    
7) save model \<name>. Эта команда позволяет сохранить текущую модель как модель с названием \<name>. Важно: при сохранении модели создаются 3 файла, в которых хранится информация о ней. Удаление хотя бы одного из них приведет к невозможности восстановления модели.
